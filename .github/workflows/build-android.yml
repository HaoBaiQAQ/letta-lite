# 主方案：编译OpenSSL（修正AR工具名）
- name: 主方案：编译OpenSSL（修正AR工具名）
  id: main_openssl
  if: env.CLANG_FOUND != 'false'
  run: |
    wget https://www.openssl.org/source/openssl-1.1.1w.tar.gz
    tar -zxf openssl-1.1.1w.tar.gz
    cd openssl-1.1.1w
    export CC=$CLANG_PATH
    # 关键修正：NDK的AR工具叫llvm-ar，不是aarch64-linux-android-ar
    export AR=$(dirname $CLANG_PATH)/llvm-ar
    # 验证AR工具可用
    $AR --version
    ./Configure android-arm64 --prefix=$GITHUB_WORKSPACE/openssl-android no-shared no-zlib
    make -j2
    make install
    echo "OPENSSL_OK=true" >> $GITHUB_ENV
